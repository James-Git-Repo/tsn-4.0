<!doctype html>
<html lang="en" data-mode="viewer">
<head>
  
 
  <meta charset="utf-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<link rel="stylesheet" href="assets/global-responsive.css">
<script defer src="assets/global-responsive.js"></script>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
 <link rel="stylesheet" href="assets/site-responsive.css">
<link rel="stylesheet" href="assets/foundation.css">
<link rel="stylesheet" href="assets/access-mode.css">
<script defer src="assets/mode-compat.js"></script>
<script defer src="assets/access-mode.js"></script>
  <title>Create New Project — The (un)Stable Net</title>

  <style>
    :root{
      --ink:#0b0f13;          /* calm navy/ink */
      --ink-2:#0f172a;        /* slate-ish deep */
      --muted:#f5f7fb;        /* page bg */
      --card:#ffffff;         /* card bg */
      --ring:#0b5fff;         /* default accent */
    }
    html,body{height:100%}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--muted)}
    /* smooth shadows + rounding */
    .card{background:var(--card); border-radius:1rem; box-shadow:0 8px 28px rgba(2,8,23,.06), 0 2px 10px rgba(2,8,23,.04)}
    .btn{border-radius:.6rem; padding:.625rem .875rem; font-weight:600}
    .btn-primary{background:var(--ring); color:white}
    .btn-primary[disabled]{opacity:.55; cursor:not-allowed}
    .btn-soft{background:#eef2ff}
    .btn-ghost{background:transparent}
    .chip{border-radius:999px; font-size:.72rem; letter-spacing:.04em; text-transform:uppercase}
    .shadow-soft{box-shadow:0 10px 30px rgba(15,23,42,.08), 0 2px 8px rgba(15,23,42,.06)}
    .focus-ring:focus{outline:3px solid rgba(11,95,255,.35); outline-offset:2px}
    .accent-bar{height:4px; border-radius:999px}
    .cover-gradient{background:linear-gradient(135deg, rgba(11,15,19,1) 0%, rgba(11,95,255,.25) 100%)}
    .visually-hidden{position:absolute!important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap}
    /* sticky bar (desktop) */
    @media(min-width:1024px){
      .sticky-actions{position:sticky; top:1rem; z-index:30}
    }
    /* fixed mobile bar */
    @media(max-width:1023.98px){
      .mobile-actions{position:fixed; left:0; right:0; bottom:0; z-index:40; background:rgba(255,255,255,.92); backdrop-filter:blur(6px); box-shadow:0 -8px 24px rgba(2,8,23,.08)}
      .mobile-safe{padding-bottom:calc(env(safe-area-inset-bottom,0) + .5rem)}
    }
    /* simple markdown styles in previews */
    .prose-lite h1{font-size:1.875rem; line-height:1.25; font-weight:800; margin:.8em 0 .4em}
    .prose-lite h2{font-size:1.375rem; line-height:1.3; font-weight:800; margin:1.1em 0 .5em}
    .prose-lite p{margin:.6em 0}
    .prose-lite ul{list-style:disc; padding-left:1.25rem; margin:.6em 0}
    .prose-lite ol{list-style:decimal; padding-left:1.25rem; margin:.6em 0}
    .prose-lite code{background:rgba(2,6,23,.06); padding:.15rem .35rem; border-radius:.35rem; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .prose-lite pre{background:rgba(2,6,23,.06); padding:.9rem; border-radius:.75rem; overflow:auto; font-size:.9rem}
    .prose-lite a{color:var(--ring); text-decoration:underline}
    /* modal */
    .modal-backdrop{background:rgba(2,6,23,.65)}
  </style>


<script defer src="assets/ui-mode-toggle.js"></script>
</head>
<body class="text-slate-900 selection:bg-blue-600/15 selection:text-blue-900">
  <!-- Global Header -->
  <header class="bg-white sticky top-0 z-40 border-b border-slate-100">
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
      <div class="h-16 flex items-center justify-between">
        <div class="flex items-center gap-4">
          <a href="index.html" class="text-sm text-slate-500 hover:text-slate-800 transition" id="backHomeTop">← Back to Home</a>
          <a href="index.html" class="flex items-center gap-2 group">
            <span class="inline-block w-7 h-7 rounded-lg bg-[var(--ink)]"></span>
            <span class="font-extrabold tracking-tight text-slate-900 group-hover:text-blue-700 transition">The (un)Stable Net</span>
          </a>
        </div>
        <nav id="primaryNav">
<nav class="hidden md:flex items-center gap-6 text-[15px]">
          <a class="text-slate-700 hover:text-blue-700 transition" href="index.html">Home</a>
          <a class="text-slate-700 hover:text-blue-700 transition" href="projects.html">Projects</a>
          <a class="text-slate-700 hover:text-blue-700 transition" href="newsletter.html">Newsletter</a>
          <a class="text-slate-700 hover:text-blue-700 transition" href="bio.html">Bio</a>
          <a class="text-slate-700 hover:text-blue-700 transition" href="contact.html">Contact</a>
        </nav>
      </div>
      <button id="navToggle" class="nav-toggle" aria-controls="primaryNav" aria-expanded="false">
      <span class="sr-only">Apri menu</span>
      <svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 pt-6 pb-28 lg:pb-16">
    <!-- helper note -->
    <section id="helperNote" class="card p-4 sm:p-5 mb-6 flex items-start gap-3" role="region" aria-label="Homepage integration note">
      <div class="flex-shrink-0 mt-0.5">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 3l9 18H3L12 3z" stroke="#0b5fff" stroke-width="1.5" fill="none"/>
          <circle cx="12" cy="17" r="1" fill="#0b5fff"/>
          <path d="M12 9v5" stroke="#0b5fff" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="text-sm leading-6 text-slate-700">
        <p class="font-semibold text-slate-900">Homepage integration</p>
        <p>If your homepage reads from <code class="px-1 rounded bg-slate-100">localStorage["projects"]</code>, this project will appear there immediately after saving. If your homepage uses a static <code class="px-1 rounded bg-slate-100">projects.json</code>, use <em>Download JSON</em> after saving and add it to that data source manually.</p>
      </div>
      <button id="dismissHelper" class="ml-auto btn btn-ghost text-slate-600 hover:text-slate-900">Dismiss</button>
    </section>

    <!-- actions: desktop sticky -->
    <div class="hidden lg:block sticky-actions mb-4">
      <div class="card px-3 py-2.5 flex items-center justify-between gap-2">
        <div class="text-sm text-slate-600 pl-1">Create a new project and wire it to Home.</div>
        <div class="flex items-center gap-2">
          <button id="saveBtn" class="btn btn-primary focus-ring disabled:opacity-60">Save Project</button>
          <button id="downloadBtn" class="btn bg-slate-900 text-white hover:bg-slate-800 focus-ring">Download JSON</button>
          <button id="previewCardBtn" class="btn btn-soft text-slate-900 hover:bg-indigo-100 focus-ring">Preview as Card</button>
          <button id="resetBtn" class="btn btn-ghost text-slate-700 hover:bg-slate-100 focus-ring">Reset Form</button>
          <a id="backHomeBtn" href="index.html" class="btn btn-ghost text-slate-700 hover:bg-slate-100">← Back to Home</a>
        </div>
      </div>
    </div>

    <!-- layout -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- LEFT: FORM -->
      <div class="space-y-6">
        <!-- Essentials -->
        <div class="card p-5">
          <div class="flex items-center justify-between mb-3">
            <h2 class="text-lg font-bold text-slate-900">Essentials</h2>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="md:col-span-2">
              <label for="title" class="block text-sm font-medium text-slate-700">Project Title <span class="text-red-600">*</span></label>
              <div class="mt-1.5 relative">
                <input id="title" name="title" type="text" autocomplete="off" spellcheck="false" maxlength="80"
                  class="w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring"
                  placeholder="e.g., European Market Movers Dashboard" aria-describedby="titleHelp titleCount">
                <div class="absolute right-2 top-2.5 text-xs text-slate-500" id="titleCount">0 / 80</div>
              </div>
              <p id="titleHelp" class="mt-1 text-xs text-slate-500">6–80 characters.</p>
              <p id="titleError" class="mt-1 text-xs text-red-600 hidden"></p>
            </div>

            <div class="md:col-span-2">
              <label for="slug" class="block text-sm font-medium text-slate-700">Slug</label>
              <input id="slug" type="text" autocomplete="off" spellcheck="false"
                class="w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring"
                placeholder="auto-generated from title" aria-describedby="slugHelp">
              <p id="slugHelp" class="mt-1 text-xs text-slate-500">Kebab-case and unique (you can edit).</p>
              <p id="slugError" class="mt-1 text-xs text-red-600 hidden"></p>
            </div>

            <div>
              <label for="subtitle" class="block text-sm font-medium text-slate-700">Subtitle / Deck (optional)</label>
              <input id="subtitle" type="text" maxlength="140"
                class="w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring"
                placeholder="One-line context for the project">
            </div>

            <div>
              <label for="date" class="block text-sm font-medium text-slate-700">Date</label>
              <input id="date" type="date"
                class="w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring">
            </div>

            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-slate-700 mb-2">Visibility</label>
              <div class="inline-flex rounded-lg border border-slate-200 overflow-hidden">
                <button type="button" data-vis="draft" class="vis-btn px-3 py-2 text-sm font-semibold bg-slate-50">Draft</button>
                <button type="button" data-vis="published" class="vis-btn px-3 py-2 text-sm font-semibold">Published</button>
              </div>
              <input type="hidden" id="visibility" value="draft">
            </div>
          </div>
        </div>

        <!-- Cover -->
        <div class="card p-5">
          <div class="flex items-center justify-between mb-3">
            <h2 class="text-lg font-bold text-slate-900">Cover</h2>
          </div>
          <div class="space-y-4">
            <div>
              <span class="block text-sm font-medium text-slate-700 mb-2">Style</span>
              <div class="inline-flex rounded-lg border border-slate-200 overflow-hidden">
                <button type="button" data-cover="solid" class="cover-btn px-3 py-2 text-sm font-semibold bg-slate-50">Solid</button>
                <button type="button" data-cover="image" class="cover-btn px-3 py-2 text-sm font-semibold">Image</button>
              </div>
              <input type="hidden" id="coverStyle" value="solid">
            </div>

            <!-- Solid controls -->
            <div id="coverSolidRow" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label for="coverColor" class="block text-sm font-medium text-slate-700">Solid Color</label>
                <input id="coverColor" type="color" class="w-full h-10 rounded-md border border-slate-200 p-1 focus-ring" value="#0b0f13">
              </div>
              <div>
                <label for="coverHex" class="block text-sm font-medium text-slate-700">Hex</label>
                <input id="coverHex" type="text" class="w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring" value="#0b0f13" placeholder="#0b0f13">
              </div>
            </div>

            <!-- Image controls -->
            <div id="coverImageRow" class="grid grid-cols-1 sm:grid-cols-2 gap-4 hidden">
              <div class="sm:col-span-2">
                <label for="coverUrl" class="block text-sm font-medium text-slate-700">Image URL</label>
                <input id="coverUrl" type="url"
                  class="w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring"
                  placeholder="https://... (Paste/Drop image URL)">
                <p class="mt-1 text-xs text-slate-500">Tip: focus this field to auto-paste a URL from your clipboard (when allowed).</p>
                <p id="coverUrlError" class="mt-1 text-xs text-red-600 hidden"></p>
              </div>
              <div class="sm:col-span-2">
                <label for="coverAlt" class="block text-sm font-medium text-slate-700">Alt text</label>
                <input id="coverAlt" type="text" maxlength="120"
                  class="w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring"
                  placeholder="Short description of the cover image" aria-describedby="altReq">
                <p id="altReq" class="mt-1 text-xs text-slate-500">Required when using an image cover.</p>
                <p id="coverAltError" class="mt-1 text-xs text-red-600 hidden"></p>
              </div>
            </div>
          </div>
        </div>

        <!-- Metadata -->
        <div class="card p-5">
          <div class="flex items-center justify-between mb-3">
            <h2 class="text-lg font-bold text-slate-900">Metadata</h2>
          </div>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-slate-700">Tags <span class="text-xs text-slate-500">(max 5)</span></label>
              <div id="tagArea" class="mt-1.5 flex flex-wrap items-center gap-2">
                <!-- chips injected here -->
                <input id="tagInput" type="text" class="min-w-[10rem] flex-1 rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring" placeholder="Type a tag and press Enter">
              </div>
              <p id="tagsError" class="mt-1 text-xs text-red-600 hidden"></p>
              <div class="mt-2 text-xs text-slate-500">Suggestions:
                <button type="button" data-suggest="AI" class="suggest chip px-2.5 py-1 bg-slate-100 hover:bg-slate-200">AI</button>
                <button type="button" data-suggest="Finance" class="suggest chip px-2.5 py-1 bg-slate-100 hover:bg-slate-200">Finance</button>
                <button type="button" data-suggest="Design" class="suggest chip px-2.5 py-1 bg-slate-100 hover:bg-slate-200">Design</button>
                <button type="button" data-suggest="Events" class="suggest chip px-2.5 py-1 bg-slate-100 hover:bg-slate-200">Events</button>
              </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label for="accentColor" class="block text-sm font-medium text-slate-700">Accent Color</label>
                <input id="accentColor" type="color" value="#0b5fff" class="w-full h-10 rounded-md border border-slate-200 p-1 focus-ring">
              </div>
              <div>
                <label for="accentHex" class="block text-sm font-medium text-slate-700">Hex</label>
                <input id="accentHex" type="text" value="#0b5fff" class="w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring">
              </div>
            </div>
          </div>
        </div>

        <!-- Content -->
        <div class="card p-5">
          <div class="flex items-center justify-between mb-3">
            <h2 class="text-lg font-bold text-slate-900">Content</h2>
          </div>
          <div class="space-y-4">
            <div>
              <label for="summary" class="block text-sm font-medium text-slate-700">Summary</label>
              <div class="mt-1.5 relative">
                <textarea id="summary" rows="3" maxlength="240" class="w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring" placeholder="A concise teaser used on the homepage card"></textarea>
                <div class="absolute right-2 bottom-2 text-xs text-slate-500" id="summaryCount">0 / 240</div>
              </div>
              <p id="summaryError" class="mt-1 text-xs text-red-600 hidden"></p>
            </div>
            <div>
              <div class="flex items-center justify-between">
                <label for="body" class="block text-sm font-medium text-slate-700">Body (Markdown)</label>
                <div class="flex items-center gap-1.5">
                  <button type="button" class="md-btn chip px-2 py-1 bg-slate-100 hover:bg-slate-200 font-semibold" data-md="bold"><strong>B</strong></button>
                  <button type="button" class="md-btn chip px-2 py-1 bg-slate-100 hover:bg-slate-200 italic" data-md="italic"><span style="font-style:italic;">I</span></button>
                  <button type="button" class="md-btn chip px-2 py-1 bg-slate-100 hover:bg-slate-200" data-md="h2">H2</button>
                  <button type="button" class="md-btn chip px-2 py-1 bg-slate-100 hover:bg-slate-200" data-md="list">List</button>
                  <button type="button" class="md-btn chip px-2 py-1 bg-slate-100 hover:bg-slate-200" data-md="link">Link</button>
                  <button type="button" class="md-btn chip px-2 py-1 bg-slate-100 hover:bg-slate-200" data-md="code">Code</button>
                </div>
              </div>
              <textarea id="body" rows="10" class="mt-1.5 w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring" placeholder="# Section&#10;Write your project details here..."></textarea>
              <div class="mt-3 p-3 rounded-lg border border-slate-200 bg-slate-50">
                <p class="text-xs font-medium text-slate-600 mb-2">Inline Markdown preview</p>
                <div id="inlineMd" class="prose-lite text-[15px] leading-6 text-slate-800"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Links -->
        <div class="card p-5">
          <div class="flex items-center justify-between mb-3">
            <h2 class="text-lg font-bold text-slate-900">Links</h2>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="sm:col-span-2">
              <label for="linkWebsite" class="block text-sm font-medium text-slate-700">Website</label>
              <input id="linkWebsite" type="url" class="w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring" placeholder="https://...">
              <p id="websiteError" class="mt-1 text-xs text-red-600 hidden"></p>
            </div>
            <div>
              <label for="linkRepo" class="block text-sm font-medium text-slate-700">Repo</label>
              <input id="linkRepo" type="url" class="w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring" placeholder="https://github.com/...">
              <p id="repoError" class="mt-1 text-xs text-red-600 hidden"></p>
            </div>
            <div>
              <label for="linkVideo" class="block text-sm font-medium text-slate-700">Video</label>
              <input id="linkVideo" type="url" class="w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring" placeholder="https://youtu.be/...">
              <p id="videoError" class="mt-1 text-xs text-red-600 hidden"></p>
            </div>
          </div>
        </div>

        <!-- SEO -->
        <div class="card p-5">
          <div class="flex items-center justify-between mb-3">
            <h2 class="text-lg font-bold text-slate-900">SEO</h2>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label for="seoTitle" class="block text-sm font-medium text-slate-700">SEO Title</label>
              <input id="seoTitle" type="text" class="w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring" placeholder="Defaults to Title">
            </div>
            <div>
              <label for="seoDesc" class="block text-sm font-medium text-slate-700">SEO Description</label>
              <input id="seoDesc" type="text" class="w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring" placeholder="Defaults to Summary">
            </div>
            <div class="sm:col-span-2">
              <label for="seoImage" class="block text-sm font-medium text-slate-700">SEO Image</label>
              <input id="seoImage" type="url" class="w-full rounded-lg border border-slate-200 px-3.5 py-2.5 focus-ring" placeholder="Defaults to Cover image URL">
              <p class="mt-1 text-xs text-slate-500" id="seoFallbacks"></p>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT: LIVE PREVIEW -->
      <div class="space-y-6">
        <!-- Project Card Preview -->
        <div class="card p-0 overflow-hidden">
          <div class="px-5 pt-5 pb-4">
            <h2 class="text-lg font-bold text-slate-900 mb-2">Project Card Preview</h2>
            <p class="text-sm text-slate-600 mb-4">This mirrors the home grid style.</p>
            <div id="cardPreview" class="group rounded-xl border border-slate-200 overflow-hidden shadow-soft">
              <div class="accent-bar mx-5 mt-4" id="cardAccent" style="background:#0b5fff"></div>
              <div class="p-5">
                <div class="flex items-center justify-between">
                  <div class="text-xs text-slate-500" id="cardDate">—</div>
                  <div class="flex gap-1.5" id="cardTags"></div>
                </div>
                <h3 id="cardTitle" class="mt-2 text-xl font-extrabold tracking-tight text-slate-900">—</h3>
                <p id="cardSummary" class="mt-1.5 text-[15px] leading-6 text-slate-700">—</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Detail Header Preview -->
        <div class="card overflow-hidden">
          <div class="px-5 pt-5">
            <h2 class="text-lg font-bold text-slate-900 mb-2">Detail Header Preview</h2>
            <p class="text-sm text-slate-600 mb-4">Hero area with cover and overlay.</p>
          </div>
          <div id="detailHero" class="relative h-56 sm:h-72 overflow-hidden">
            <div id="heroImage" class="absolute inset-0 hidden bg-cover bg-center"></div>
            <div id="heroSolid" class="absolute inset-0 cover-gradient"></div>
            <div class="absolute inset-0" style="background:linear-gradient(0deg, rgba(2,6,23,.55), rgba(2,6,23,.15))"></div>
            <div class="absolute inset-0 p-6 sm:p-8 flex flex-col justify-end">
              <div class="flex items-center gap-2 mb-2" id="heroMeta">
                <span class="chip px-2 py-1 bg-black/40 text-white/90" id="heroDate">—</span>
                <div id="heroTags" class="flex flex-wrap gap-1.5"></div>
              </div>
              <h1 id="heroTitle" class="text-white text-2xl sm:text-3xl font-extrabold leading-tight">—</h1>
              <p id="heroSubtitle" class="text-white/85 text-sm sm:text-base mt-1">—</p>
            </div>
          </div>
          <div class="px-5 pb-6">
            <div class="mt-5 prose-lite text-[16px] leading-7 text-slate-800" id="bodyPreview"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- actions: mobile fixed -->
    <div class="lg:hidden mobile-actions">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 mobile-safe">
        <div class="flex items-center gap-2 py-2">
          <button id="saveBtn_m" class="flex-1 btn btn-primary">Save</button>
          <button id="downloadBtn_m" class="btn bg-slate-900 text-white">JSON</button>
          <button id="previewCardBtn_m" class="btn btn-soft text-slate-900">Card</button>
          <a id="backHomeBtn_m" href="index.html" class="btn btn-ghost">Home</a>
        </div>
      </div>
    </div>
  </main>

  <!-- Toast -->
  <div id="toast" class="fixed right-4 bottom-4 sm:right-6 sm:bottom-6 hidden z-50">
    <div class="card p-4 w-[min(92vw,26rem)]" role="status" aria-live="polite">
      <div class="flex items-start gap-3">
        <div class="mt-0.5 text-blue-600">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 2a10 10 0 1010 10A10.011 10.011 0 0012 2zm0 5.75a1.25 1.25 0 11-1.25 1.25A1.25 1.25 0 0112 7.75zM13.25 17h-2.5v-6h2.5z" fill="#0b5fff"/>
          </svg>
        </div>
        <div class="flex-1">
          <p class="font-semibold text-slate-900">Project saved</p>
          <p class="text-sm text-slate-600">It’s now in your browser’s storage. You can open Home to see it or download a JSON file.</p>
          <div class="mt-3 flex gap-2">
            <a href="index.html" class="btn bg-slate-900 text-white hover:bg-slate-800">Open Home</a>
            <button id="toastDownload" class="btn btn-soft text-slate-900 hover:bg-indigo-100">Download JSON</button>
          </div>
        </div>
        <button id="toastClose" class="btn btn-ghost text-slate-600 hover:text-slate-900">✕</button>
      </div>
    </div>
  </div>

  <!-- Modal: Card Preview -->
  <div id="modal" class="fixed inset-0 hidden items-center justify-center z-50" aria-modal="true" role="dialog" aria-labelledby="modalTitle">
    <div class="absolute inset-0 modal-backdrop"></div>
    <div class="card relative w-[min(92vw,34rem)] max-h-[85vh] overflow-auto">
      <div class="flex items-center justify-between px-5 py-4 border-b border-slate-100">
        <h3 id="modalTitle" class="text-base font-bold text-slate-900">Homepage Card Preview</h3>
        <button id="modalClose" class="btn btn-ghost text-slate-600 hover:text-slate-900">✕</button>
      </div>
      <div class="p-5">
        <div id="modalCard" class="rounded-xl border border-slate-200 overflow-hidden shadow-soft">
          <div class="accent-bar mx-5 mt-4" id="modalAccent" style="background:#0b5fff"></div>
          <div class="p-5">
            <div class="flex items-center justify-between">
              <div class="text-xs text-slate-500" id="modalDate">—</div>
              <div class="flex gap-1.5" id="modalTags"></div>
            </div>
            <h3 id="modalTitleH" class="mt-2 text-xl font-extrabold tracking-tight text-slate-900">—</h3>
            <p id="modalSummary" class="mt-1.5 text-[15px] leading-6 text-slate-700">—</p>
          </div>
        </div>
      </div>
      <div class="px-5 pb-5">
        <button id="modalClose2" class="btn btn-primary w-full">Close</button>
      </div>
    </div>
  </div>

  <!-- Global Footer -->
  <footer class="mt-8 border-t border-slate-200 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-8">
      <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
        <p class="text-sm text-slate-600">&copy; <span id="year"></span> The (un)Stable Net</p>
        <div class="flex items-center gap-4">
          <!-- Email -->
          <a class="p-2 rounded-lg hover:bg-slate-100" href="mailto:hello@example.com" aria-label="Email">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M4 6h16v12H4z" stroke="#0b0f13" stroke-width="1.5" fill="none"/>
              <path d="M4 7l8 6 8-6" stroke="#0b0f13" stroke-width="1.5" fill="none"/>
            </svg>
          </a>
          <!-- LinkedIn -->
          <a class="p-2 rounded-lg hover:bg-slate-100" href="https://www.linkedin.com" target="_blank" rel="noreferrer" aria-label="LinkedIn">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <rect x="3" y="3" width="18" height="18" rx="2" stroke="#0b0f13" stroke-width="1.5" fill="none"/>
              <rect x="6.75" y="9.5" width="2.5" height="7.75" fill="#0b0f13"/>
              <circle cx="8" cy="7.5" r="1.25" fill="#0b0f13"/>
              <path d="M12.25 17.25v-4.2a2.05 2.05 0 114.1 0v4.2h-2.5v-3.95c0-.5-.4-.9-.9-.9s-.7.3-.7.9v3.95z" fill="#0b0f13"/>
            </svg>
          </a>
          <!-- GitHub -->
          <a class="p-2 rounded-lg hover:bg-slate-100" href="https://github.com" target="_blank" rel="noreferrer" aria-label="GitHub">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 2C6.48 2 2 6.6 2 12.26c0 4.51 2.87 8.33 6.85 9.68.5.1.69-.22.69-.49 0-.24-.01-.86-.01-1.68-2.78.62-3.37-1.36-3.37-1.36-.45-1.18-1.11-1.5-1.11-1.5-.91-.64.07-.63.07-.63 1 .07 1.52 1.05 1.52 1.05 .9 1.57 2.36 1.12 2.94.86.09-.67.35-1.12.63-1.38-2.22-.26-4.56-1.14-4.56-5.06 0-1.12.39-2.04 1.03-2.76-.1-.26-.45-1.31.1-2.73 0 0 .85-.28 2.78 1.05a9.25 9.25 0 015.06 0c1.92-1.33 2.77-1.05 2.77-1.05 .56 1.42.21 2.47.1 2.73 .64.72 1.03 1.64 1.03 2.76 0 3.93-2.34 4.8-4.57 5.05 .36.32.67.95.67 1.92 0 1.38-.01 2.49-.01 2.83 0 .27.18.6.7.49A10.04 10.04 0 0022 12.26C22 6.6 17.52 2 12 2z" fill="#0b0f13"/>
            </svg>
          </a>
          <!-- X -->
          <a class="p-2 rounded-lg hover:bg-slate-100" href="https://x.com" target="_blank" rel="noreferrer" aria-label="X">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M4 4l16 16M20 4L4 20" stroke="#0b0f13" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </footer>

  <div id="liveRegion" class="visually-hidden" aria-live="polite"></div>

  <script>
    // ---------- Utilities ----------
    const $ = sel => document.querySelector(sel);
    const $all = sel => Array.from(document.querySelectorAll(sel));

    const todayISO = () => new Date().toISOString().slice(0,10);
    const nowISO = () => new Date().toISOString();
    const formatDateUI = (iso) => {
      try {
        const d = new Date(iso);
        return d.toLocaleDateString('en-GB', { day:'2-digit', month:'short', year:'numeric' });
      } catch { return iso }
    }

    const uuidv4 = () =>
      ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,c=>
        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
      );

    const kebab = (s) => s
      .toLowerCase()
      .replace(/['’]/g,'')
      .replace(/[^a-z0-9]+/g,'-')
      .replace(/^-+|-+$/g,'')
      .slice(0,96);

    const isValidUrl = (u) => {
      if(!u) return false;
      try { const x=new URL(u); return ['http:','https:'].includes(x.protocol) } catch { return false }
    }
    const isImageUrlish = (u) => /\.(png|jpe?g|webp|gif|svg)(\?.*)?$/i.test(u);

    // ---------- Minimal Markdown Renderer ----------
    function escapeHtml(s){ return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])) }
    function mdRender(src){
      let s = escapeHtml(src || '');
      // code fences
      s = s.replace(/```([\s\S]*?)```/g, (m, p1) => `<pre><code>${p1.replace(/\n$/,'')}</code></pre>`);
      // headings
      s = s.replace(/^###### (.*)$/gm, '<h6>$1</h6>')
           .replace(/^##### (.*)$/gm, '<h5>$1</h5>')
           .replace(/^#### (.*)$/gm, '<h4>$1</h4>')
           .replace(/^### (.*)$/gm, '<h3>$1</h3>')
           .replace(/^## (.*)$/gm, '<h2>$1</h2>')
           .replace(/^# (.*)$/gm, '<h1>$1</h1>');
      // lists
      s = s.replace(/^(?:-|\*) (.*)$/gm, '<li>$1</li>');
      s = s.replace(/(<li>[\s\S]*?<\/li>)(?!(?:\n<li>|$))/g, '<ul>$1</ul>');
      // bold/italic/code
      s = s.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
      s = s.replace(/_(.+?)_/g, '<em>$1</em>');
      s = s.replace(/`([^`]+?)`/g, '<code>$1</code>');
      // links
      s = s.replace(/\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g, '<a href="$2" target="_blank" rel="noreferrer">$1</a>');
      // paragraphs
      s = s.replace(/(^|\n)([^\n<].+)(?=\n|$)/g, (m, a, b) => /\<(h\d|ul|pre|li|p)/.test(b) ? a+b : a+`<p>${b}</p>`);
      return s;
    }

    // ---------- State ----------
    let slugEdited = false;
    let dirty = false;

    const defaultProject = () => ({
      id: uuidv4(),
      slug: '',
      title: '',
      subtitle: '',
      date: todayISO(),
      tags: [],
      accent: '#0b5fff',
      cover: {
        style: 'solid',
        imageUrl: '',
        alt: ''
      },
      summary: '',
      body: '',
      links: { website:'', repo:'', video:'' },
      seo: { title:'', description:'', image:'' },
      visibility: 'draft',
      createdAt: nowISO(),
      updatedAt: nowISO()
    });

    let project = defaultProject();

    // ---------- LocalStorage projects array ----------
    function getProjects(){
      try{ return JSON.parse(localStorage.getItem('projects')||'[]') }catch{ return [] }
    }
    function setProjects(arr){
      localStorage.setItem('projects', JSON.stringify(arr));
    }

    // ---------- Helpers ----------
    function announce(msg){ const lr = $('#liveRegion'); lr.textContent=''; setTimeout(()=>lr.textContent=msg,10) }

    function refreshSeoFallbacks(){
      $('#seoFallbacks').textContent =
        `Fallbacks → Title: "${project.title || '—'}", Description: "${project.summary || '—'}", Image: ${project.cover.imageUrl ? project.cover.imageUrl : '—'}`;
    }

    function setDirty(){
      if(!dirty){ dirty = true; }
    }

    window.addEventListener('beforeunload', (e)=>{
      if(dirty){
        e.preventDefault();
        e.returnValue = '';
      }
    });

    // ---------- Form Bindings ----------
    function bindBasics(){
      // Title
      const title = $('#title');
      title.addEventListener('input', e=>{
        project.title = e.target.value.trimStart();
        $('#titleCount').textContent = `${project.title.length} / 80`;
        validateField('title');
        if(!slugEdited){
          const newSlug = kebab(project.title);
          $('#slug').value = newSlug;
          project.slug = newSlug;
          validateField('slug');
        }
        renderPreviews();
        setDirty();
      });

      // Slug
      const slug = $('#slug');
      slug.addEventListener('input', e=>{
        slugEdited = true;
        const cleaned = kebab(e.target.value);
        e.target.value = cleaned;
        project.slug = cleaned;
        validateField('slug');
        setDirty();
      });

      // Subtitle
      $('#subtitle').addEventListener('input', e=>{
        project.subtitle = e.target.value;
        renderPreviews();
        setDirty();
      });

      // Date
      $('#date').addEventListener('change', e=>{
        project.date = e.target.value || todayISO();
        renderPreviews();
        setDirty();
      });

      // Visibility
      $all('.vis-btn').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          $all('.vis-btn').forEach(b=>b.classList.remove('bg-slate-50'));
          btn.classList.add('bg-slate-50');
          const v = btn.getAttribute('data-vis');
          project.visibility = v;
          $('#visibility').value = v;
          setDirty();
        })
      });
    }

    function bindCover(){
      // toggle
      $all('.cover-btn').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          $all('.cover-btn').forEach(b=>b.classList.remove('bg-slate-50'));
          btn.classList.add('bg-slate-50');
          const style = btn.getAttribute('data-cover');
          project.cover.style = style;
          $('#coverStyle').value = style;
          $('#coverSolidRow').classList.toggle('hidden', style!=='solid');
          $('#coverImageRow').classList.toggle('hidden', style!=='image');
          validateField('cover');
          renderPreviews();
          setDirty();
        })
      });

      // Solid color
      const color = $('#coverColor'), hex = $('#coverHex');
      color.addEventListener('input', e=>{
        hex.value = e.target.value;
        renderPreviews();
        setDirty();
      });
      hex.addEventListener('input', e=>{
        let v = e.target.value.trim();
        if(!v.startsWith('#')) v = '#'+v.replace(/^#+/,'');
        if(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(v)){
          color.value = v;
          e.target.classList.remove('ring-2','ring-red-500');
        }else{
          e.target.classList.add('ring-2','ring-red-500');
        }
        renderPreviews();
        setDirty();
      });

      // Image url + alt
      const url = $('#coverUrl');
      const alt = $('#coverAlt');

      url.addEventListener('input', ()=>{
        project.cover.imageUrl = url.value.trim();
        validateField('cover');
        renderPreviews();
        setDirty();
      });
      url.addEventListener('dragover', e=>{ e.preventDefault(); });
      url.addEventListener('drop', e=>{
        e.preventDefault();
        const text = e.dataTransfer.getData('text/plain');
        if(isValidUrl(text)){ url.value = text; project.cover.imageUrl = text; validateField('cover'); renderPreviews(); setDirty(); }
      });
      url.addEventListener('focus', async ()=>{
        try{
          const clip = await navigator.clipboard.readText();
          if(!url.value && isValidUrl(clip) && isImageUrlish(clip)){
            url.value = clip;
            project.cover.imageUrl = clip;
            validateField('cover'); renderPreviews(); setDirty();
            announce('Image URL auto-pasted from clipboard');
          }
        }catch{}
      });

      alt.addEventListener('input', ()=>{
        project.cover.alt = alt.value.trim();
        validateField('cover');
        setDirty();
      });
    }

    function bindMetadata(){
      // tags
      const input = $('#tagInput');
      const area = $('#tagArea');
      function addTag(t){
        t = t.trim();
        if(!t) return;
        if(project.tags.length >= 5) { showError('tagsError','Maximum 5 tags'); return; }
        if(project.tags.includes(t)) return;
        project.tags.push(t);
        renderTags(); renderPreviews(); hideError('tagsError'); setDirty();
      }
      function removeTag(t){
        project.tags = project.tags.filter(x=>x!==t);
        renderTags(); renderPreviews(); hideError('tagsError'); setDirty();
      }
      function renderTags(){
        // remove all chips except input
        $all('#tagArea .tag-chip').forEach(n=>n.remove());
        project.tags.forEach((t,i)=>{
          const chip = document.createElement('button');
          chip.type='button';
          chip.draggable = true;
          chip.className='tag-chip chip px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-700 flex items-center gap-2';
          chip.innerHTML = `<span>${t}</span><span aria-hidden="true">✕</span>`;
          chip.addEventListener('click', ()=>removeTag(t));
          // drag-to-reorder
          chip.addEventListener('dragstart', (e)=>{ e.dataTransfer.setData('text/plain', String(i)); });
          chip.addEventListener('dragover', (e)=>e.preventDefault());
          chip.addEventListener('drop', (e)=>{
            e.preventDefault();
            const from = Number(e.dataTransfer.getData('text/plain'));
            const to = i;
            const arr = project.tags;
            const [m] = arr.splice(from,1);
            arr.splice(to,0,m);
            renderTags(); renderPreviews(); setDirty();
          });
          chip.classList.add('tag-chip');
          area.insertBefore(chip, input);
        });
        // card/hero tags are re-rendered in renderPreviews
      }
      input.addEventListener('keydown', (e)=>{
        if(e.key==='Enter' || e.key===','){
          e.preventDefault();
          const val = input.value.trim();
          if(val){ addTag(val); input.value=''; }
        } else if(e.key==='Backspace' && !input.value && project.tags.length){
          project.tags.pop(); renderTags(); renderPreviews(); setDirty();
        }
      });
      $all('.suggest').forEach(btn=>{
        btn.addEventListener('click', ()=> addTag(btn.dataset.suggest));
      });

      // accent sync
      const acc = $('#accentColor'), accHex = $('#accentHex');
      acc.addEventListener('input', e=>{
        project.accent = e.target.value;
        accHex.value = project.accent;
        renderPreviews(); setDirty();
      });
      accHex.addEventListener('input', e=>{
        let v = e.target.value.trim();
        if(!v.startsWith('#')) v = '#'+v.replace(/^#+/,'');
        if(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(v)){
          project.accent = v; acc.value = v; e.target.classList.remove('ring-2','ring-red-500');
          renderPreviews();
        } else {
          e.target.classList.add('ring-2','ring-red-500');
        }
        setDirty();
      });
    }

    function bindContent(){
      // summary
      const sum = $('#summary');
      sum.addEventListener('input', e=>{
        project.summary = e.target.value;
        $('#summaryCount').textContent = `${project.summary.length} / 240`;
        validateField('summary');
        renderPreviews(); setDirty();
      });

      // body + toolbar
      const body = $('#body');
      const inline = $('#inlineMd');
      const applyMd = (cmd)=>{
        const { selectionStart:s, selectionEnd:e, value:v } = body;
        const sel = v.slice(s,e) || 'text';
        let before='', after='', insert='';
        if(cmd==='bold'){ before='**'; after='**'; }
        if(cmd==='italic'){ before='_'; after='_'; }
        if(cmd==='h2'){ before='## '; }
        if(cmd==='list'){ before='- '; }
        if(cmd==='link'){ insert=`[${sel}](https://)`; }
        if(cmd==='code'){
          insert = "```\n" + sel + "\n```";
        }
        if(insert){
          body.setRangeText(insert, s, e, 'end');
        } else {
          body.setRangeText(before + sel + (after||''), s, e, 'end');
        }
        body.dispatchEvent(new Event('input', {bubbles:true}));
        body.focus();
      };
      $all('.md-btn').forEach(b=>{
        b.addEventListener('click', ()=>applyMd(b.dataset.md));
      });
      body.addEventListener('input', e=>{
        project.body = e.target.value;
        inline.innerHTML = mdRender(project.body);
        $('#bodyPreview').innerHTML = mdRender(project.body);
        setDirty();
      });
    }

    function bindLinksSeo(){
      const ws = $('#linkWebsite'), rp = $('#linkRepo'), vd = $('#linkVideo');
      ws.addEventListener('input', ()=>{ project.links.website = ws.value.trim(); validateField('website'); setDirty(); });
      rp.addEventListener('input', ()=>{ project.links.repo = rp.value.trim(); validateField('repo'); setDirty(); });
      vd.addEventListener('input', ()=>{ project.links.video = vd.value.trim(); validateField('video'); setDirty(); });

      $('#seoTitle').addEventListener('input', e=>{ project.seo.title = e.target.value; refreshSeoFallbacks(); setDirty(); });
      $('#seoDesc').addEventListener('input', e=>{ project.seo.description = e.target.value; refreshSeoFallbacks(); setDirty(); });
      $('#seoImage').addEventListener('input', e=>{ project.seo.image = e.target.value.trim(); refreshSeoFallbacks(); setDirty(); });
    }

    // ---------- Validation ----------
    function showError(id,msg){ const el = $('#'+id); el.textContent = msg; el.classList.remove('hidden') }
    function hideError(id){ const el = $('#'+id); el.textContent=''; el.classList.add('hidden') }

    function validateField(name){
      switch(name){
        case 'title': {
          const ok = project.title.trim().length >= 6 && project.title.trim().length <= 80;
          ok ? hideError('titleError') : showError('titleError', 'Title must be 6–80 characters.');
          return ok;
        }
        case 'slug': {
          const pattern = /^[a-z0-9]+(?:-[a-z0-9]+)*$/;
          let msg = '';
          if(!project.slug) msg='Slug is required.';
          else if(!pattern.test(project.slug)) msg='Use kebab-case (a–z, 0–9, hyphens).';
          else {
            const existing = getProjects().find(p=>p.slug===project.slug && p.id!==project.id);
            if(existing) msg='Slug already exists in your browser.';
          }
          if(msg){ showError('slugError', msg); return false } else { hideError('slugError'); return true }
        }
        case 'summary': {
          const ok = project.summary.length <= 240;
          ok ? hideError('summaryError') : showError('summaryError','Summary must be ≤ 240 chars.');
          return ok;
        }
        case 'cover': {
          if(project.cover.style==='image'){
            const uok = isValidUrl(project.cover.imageUrl);
            const aok = project.cover.alt.trim().length>0;
            !uok ? showError('coverUrlError','Valid image URL required.') : hideError('coverUrlError');
            !aok ? showError('coverAltError','Alt text is required for image covers.') : hideError('coverAltError');
            return uok && aok;
          } else {
            hideError('coverUrlError'); hideError('coverAltError'); return true;
          }
        }
        case 'website': {
          const v = project.links.website;
          if(!v){ hideError('websiteError'); return true }
          const ok = isValidUrl(v);
          ok ? hideError('websiteError') : showError('websiteError','Enter a valid URL (https://)');
          return ok;
        }
        case 'repo': {
          const v = project.links.repo;
          if(!v){ hideError('repoError'); return true }
          const ok = isValidUrl(v);
          ok ? hideError('repoError') : showError('repoError','Enter a valid URL (https://)');
          return ok;
        }
        case 'video': {
          const v = project.links.video;
          if(!v){ hideError('videoError'); return true }
          const ok = isValidUrl(v);
          ok ? hideError('videoError') : showError('videoError','Enter a valid URL (https://)');
          return ok;
        }
      }
      return true;
    }

    function validateAll(){
      const checks = ['title','slug','summary','cover','website','repo','video'].map(validateField);
      const ok = checks.every(Boolean) && project.tags.length<=5;
      setSaveEnabled(ok);
      return ok;
    }

    function setSaveEnabled(enabled){
      $('#saveBtn').disabled = !enabled;
      $('#saveBtn_m').disabled = !enabled;
    }

    // ---------- Previews ----------
    function renderPreviews(){
      // card
      $('#cardAccent').style.background = project.accent || '#0b5fff';
      $('#cardTitle').textContent = project.title || '—';
      $('#cardSummary').textContent = project.summary || project.subtitle || '—';
      $('#cardDate').textContent = project.date ? formatDateUI(project.date) : '—';

      const tagsWrap = $('#cardTags'); tagsWrap.innerHTML='';
      project.tags.slice(0,5).forEach(t=>{
        const el = document.createElement('span');
        el.className='chip px-2 py-1 bg-slate-100 text-slate-700';
        el.textContent = t;
        tagsWrap.appendChild(el);
      });

      // modal card mirrors
      $('#modalAccent').style.background = project.accent || '#0b5fff';
      $('#modalTitleH').textContent = project.title || '—';
      $('#modalSummary').textContent = project.summary || project.subtitle || '—';
      $('#modalDate').textContent = project.date ? formatDateUI(project.date) : '—';
      const mTags = $('#modalTags'); mTags.innerHTML='';
      project.tags.slice(0,5).forEach(t=>{
        const el = document.createElement('span');
        el.className='chip px-2 py-1 bg-slate-100 text-slate-700';
        el.textContent = t;
        mTags.appendChild(el);
      });

      // hero
      $('#heroTitle').textContent = project.title || '—';
      $('#heroSubtitle').textContent = project.subtitle || project.summary || '—';
      $('#heroDate').textContent = project.date ? formatDateUI(project.date) : '—';
      const hTags = $('#heroTags'); hTags.innerHTML='';
      project.tags.slice(0,5).forEach(t=>{
        const el = document.createElement('span');
        el.className='chip px-2 py-1 bg-white/15 text-white';
        el.textContent = t;
        hTags.appendChild(el);
      });

      if(project.cover.style==='image' && isValidUrl(project.cover.imageUrl)){
        $('#heroImage').style.backgroundImage = `url('${project.cover.imageUrl}')`;
        $('#heroImage').classList.remove('hidden');
        $('#heroSolid').classList.add('hidden');
      } else {
        const solid = $('#coverHex').value || '#0b0f13';
        $('#heroImage').classList.add('hidden');
        $('#heroSolid').classList.remove('hidden');
        $('#heroSolid').style.background = `linear-gradient(135deg, ${solid} 0%, ${project.accent}33 100%)`;
      }

      // body
      $('#bodyPreview').innerHTML = mdRender(project.body);
      refreshSeoFallbacks();
      validateAll();
    }

    // ---------- Save & Download ----------
    function buildOutput(){
      const out = JSON.parse(JSON.stringify(project));
      // cover solid color is stored via cover.style='solid' and color picked is represented via the hero gradient;
      // We keep it implicit; accent remains the main color.
      out.date = project.date || todayISO();
      out.updatedAt = nowISO();
      // SEO fallbacks
      out.seo = {
        title: project.seo.title || project.title,
        description: project.seo.description || project.summary,
        image: project.seo.image || (project.cover.style==='image' ? project.cover.imageUrl : '')
      };
      return out;
    }

    function saveToLocal(){
      const out = buildOutput();
      const arr = getProjects();
      const idx = arr.findIndex(p=>p.id===out.id || p.slug===out.slug);
      if(idx>=0){ arr[idx] = out } else { arr.unshift(out) }
      setProjects(arr);
      project.createdAt = project.createdAt || nowISO();
      project.updatedAt = out.updatedAt;
      dirty = false;
      return out;
    }

    function downloadJSON(out){
      const slug = out.slug || 'project';
      const blob = new Blob([JSON.stringify(out, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `project-${slug}.json`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    // ---------- UI Actions ----------
    function openToast(){
      $('#toast').classList.remove('hidden');
      announce('Project saved');
    }
    function closeToast(){ $('#toast').classList.add('hidden') }

    function openModal(){ $('#modal').classList.remove('hidden'); $('#modal').classList.add('flex') }
    function closeModal(){ $('#modal').classList.add('hidden'); $('#modal').classList.remove('flex') }

    function resetForm(){
      if(dirty && !confirm('Discard unsaved changes?')) return;
      slugEdited = false;
      project = defaultProject();
      populateForm();
      renderPreviews();
      dirty = false;
      announce('Form reset');
    }

    function populateForm(){
      $('#year').textContent = new Date().getFullYear();
      project.date = project.date || todayISO();
      $('#title').value = project.title; $('#titleCount').textContent='0 / 80';
      $('#slug').value = project.slug;
      $('#subtitle').value = project.subtitle;
      $('#date').value = project.date || todayISO();
      $('#visibility').value = project.visibility;
      $all('.vis-btn').forEach(b=>b.classList.toggle('bg-slate-50', b.getAttribute('data-vis')===project.visibility));

      // cover
      $('#coverStyle').value = project.cover.style;
      $all('.cover-btn').forEach(b=>b.classList.toggle('bg-slate-50', b.getAttribute('data-cover')===project.cover.style));
      $('#coverSolidRow').classList.toggle('hidden', project.cover.style!=='solid');
      $('#coverImageRow').classList.toggle('hidden', project.cover.style!=='image');
      $('#coverColor').value = '#0b0f13';
      $('#coverHex').value = '#0b0f13';
      $('#coverUrl').value = project.cover.imageUrl || '';
      $('#coverAlt').value = project.cover.alt || '';

      // metadata
      $('#accentColor').value = project.accent || '#0b5fff';
      $('#accentHex').value = project.accent || '#0b5fff';
      $('#tagInput').value='';
      // remove existing chips (if any)
      $all('#tagArea .tag-chip').forEach(n=>n.remove());
      project.tags.forEach(()=>{}); // will render in renderPreviews via renderTags call below
      // content
      $('#summary').value = project.summary; $('#summaryCount').textContent = `${project.summary.length} / 240`;
      $('#body').value = project.body; $('#inlineMd').innerHTML = mdRender(project.body);

      // links & seo
      $('#linkWebsite').value = project.links.website || '';
      $('#linkRepo').value = project.links.repo || '';
      $('#linkVideo').value = project.links.video || '';
      $('#seoTitle').value = project.seo.title || '';
      $('#seoDesc').value = project.seo.description || '';
      $('#seoImage').value = project.seo.image || '';

      // helper note persistence
      const helperDismissed = localStorage.getItem('projects_helper_dismissed')==='1';
      $('#helperNote').classList.toggle('hidden', helperDismissed);
    }

    // ---------- Events ----------
    function bindActions(){
      // desktop
      $('#saveBtn').addEventListener('click', ()=>{
        if(!validateAll()) return;
        const out = saveToLocal();
        openToast();
      });
      $('#downloadBtn').addEventListener('click', ()=> downloadJSON(buildOutput()));
      $('#previewCardBtn').addEventListener('click', ()=> openModal());
      $('#resetBtn').addEventListener('click', resetForm);
      $('#backHomeBtn').addEventListener('click', (e)=>{ if(dirty && !confirm('You have unsaved changes. Leave page?')) e.preventDefault() });
      $('#backHomeTop').addEventListener('click', (e)=>{ if(dirty && !confirm('You have unsaved changes. Leave page?')) e.preventDefault() });

      // mobile
      $('#saveBtn_m').addEventListener('click', ()=>{ if(!validateAll()) return; saveToLocal(); openToast(); });
      $('#downloadBtn_m').addEventListener('click', ()=> downloadJSON(buildOutput()));
      $('#previewCardBtn_m').addEventListener('click', ()=> openModal());
      $('#backHomeBtn_m').addEventListener('click', (e)=>{ if(dirty && !confirm('You have unsaved changes. Leave page?')) e.preventDefault() });

      // toast
      $('#toastDownload').addEventListener('click', ()=> downloadJSON(buildOutput()));
      $('#toastClose').addEventListener('click', closeToast);

      // modal
      $('#modalClose').addEventListener('click', closeModal);
      $('#modalClose2').addEventListener('click', closeModal);
      $('#modal').addEventListener('click', (e)=>{ if(e.target.id==='modal') closeModal() });

      // helper dismiss
      $('#dismissHelper').addEventListener('click', ()=>{
        localStorage.setItem('projects_helper_dismissed','1');
        $('#helperNote').classList.add('hidden');
      });
    }

    // ---------- Init ----------
    function init(){
      $('#year').textContent = new Date().getFullYear();
      project.date = todayISO();
      populateForm();
      bindBasics();
      bindCover();
      bindMetadata();
      bindContent();
      bindLinksSeo();
      bindActions();
      // initial tag render (empty)
      // renderPreviews will call validateAll
      renderTags();
      renderPreviews();
      setSaveEnabled(false);
    }

    function renderTags(){
      // utility to re-render tag chips in input area
      const input = $('#tagInput');
      $all('#tagArea .tag-chip').forEach(n=>n.remove());
      project.tags.forEach((t,i)=>{
        const chip = document.createElement('button');
        chip.type='button'; chip.draggable = true;
        chip.className='tag-chip chip px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-700 flex items-center gap-2';
        chip.innerHTML = `<span>${t}</span><span aria-hidden="true">✕</span>`;
        chip.addEventListener('click', ()=>{ project.tags.splice(i,1); renderTags(); renderPreviews(); setDirty(); });
        chip.addEventListener('dragstart',(e)=>{ e.dataTransfer.setData('text/plain', String(i)); });
        chip.addEventListener('dragover',(e)=>e.preventDefault());
        chip.addEventListener('drop',(e)=>{ e.preventDefault(); const from=Number(e.dataTransfer.getData('text/plain')); const to=i; const arr=project.tags; const [m]=arr.splice(from,1); arr.splice(to,0,m); renderTags(); renderPreviews(); setDirty(); });
        input.parentElement.insertBefore(chip, input);
      });
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
  <script type="module" src="assets/sb-init.js"></script>
<script type="module" src="assets/editor-auth.js"></script>
<script type="module" src="assets/editor-tray.js"></script>

<script type="module" src="assets/live-all-norepl.js"></script>
</body></html>
