<!doctype html>
<html lang="en" data-mode="viewer">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<link rel="stylesheet" href="assets/global-responsive.css">
<script defer src="assets/global-responsive.js"></script>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<link rel="stylesheet" href="assets/foundation.css">
<link rel="stylesheet" href="assets/access-mode.css">
<script defer src="assets/mode-compat.js"></script>
<script defer src="assets/access-mode.js"></script>

  <title>Jacopo Berton — Full Bio</title>

  <style>
    /* — Header parity with EMM — */
.nav{ height:72px; display:flex; align-items:center; justify-content:space-between }
.brand{ display:flex; align-items:center; gap:12px }
.mark{
  width:36px; height:36px; border-radius:12px; display:grid; place-items:center; color:#fff;
  background:conic-gradient(from 210deg, var(--brand, #1f4aff), #00b7ff);
  box-shadow:0 10px 30px rgba(12,23,52,.08);
}
.site-name{ margin:0; font-weight:800; font-size:18px; line-height:1 }

.pill-row{ display:flex; align-items:center; gap:12px; list-style:none; margin:0; padding:0 }
.pill-btn{
  appearance:none; display:inline-flex; align-items:center; gap:6px; text-decoration:none;
  background:#fff; color:#1f3aa2; border:1.5px solid #dbe6ff; border-radius:14px;
  padding:12px 18px; font-weight:800; font-size:16px; line-height:1;
  transition:background .15s ease, box-shadow .15s ease; box-shadow:0 1px 0 rgba(12,23,52,.02);
  cursor:pointer;
}
.pill-btn:hover{ background:#f4f7ff }
.pill-btn.primary{
  background:linear-gradient(180deg,#2954ff,#1f4aff); color:#fff; border-color:#2140b8;
  box-shadow:0 6px 18px rgba(31,74,255,.20), inset 0 1px 0 rgba(255,255,255,.25);
}
    /* --- Modal footer layout fix (overrides viewer CSS) --- */
    .dlg-actions button,
    .dialog-foot button { width:auto !important; display:inline-flex !important; }
    .dlg-actions{ display:flex; gap:10px; justify-content:flex-end; align-items:center; }
    .dialog-foot{ display:flex; gap:10px; justify-content:space-between; align-items:center; }

    :root{--line:#e7edf7; --ink:#0b152c; --maxw:920px; --ink-2:#4c5c83; --brand:#2140b8}
    *{box-sizing:border-box}
    body{margin:0; font-family:Inter,system-ui,sans-serif; color:var(--ink); background:linear-gradient(180deg,#f7faff,#ffffff)}

    header{position:sticky;top:0;background:rgba(255,255,255,.8);backdrop-filter:blur(8px);border-bottom:1px solid var(--line); z-index:10}
    a{color:var(--brand); text-decoration:none}
    .wrap{max-width:var(--maxw); margin:0 auto; padding:18px 20px}
    img, video { max-width:100%; height:auto; display:block }

    /* Shared pill button */
    .ft-btn{
      appearance:none; display:inline-flex; align-items:center; gap:6px;
      text-decoration:none; background:#fff; color:#1f3aa2;
      border:1.5px solid #dbe6ff; border-radius:14px;
      padding:12px 18px; font-weight:800; font-size:16px; line-height:1.1;
      cursor:pointer; transition: box-shadow .2s, transform .02s, background .2s;
      box-shadow:0 0 0 0 rgba(33,64,184,0);
    }
    .ft-btn:hover{ background:#f7faff; box-shadow:0 0 0 3px rgba(33,64,184,.08) }
    .ft-btn:focus-visible{ outline:0; box-shadow:0 0 0 3px rgba(33,64,184,.18) }
    .ft-btn:active{ transform:translateY(1px) }

    /* Two-column head */
    .head{ display:grid; grid-template-columns:260px 1fr; gap:20px; align-items:start }

    .photo-wrap{ position:relative }
    .photo{
      width:100%; aspect-ratio:1/1; border-radius:18px;
      border:2px solid #0f3299; box-shadow:0 10px 30px rgba(12,23,52,.08);
      background: url('https://dummyimage.com/800x800/1b274d/ced9ff&text=Your+Photo') center/cover no-repeat; overflow:hidden
    }
    .photo.drop{ outline:2px dashed #b8c6ff; outline-offset:-8px }
    .photo-actions{ position:absolute; right:10px; bottom:10px; display:flex; gap:8px }

    .btn{ border:1px solid var(--line); background:#fff; color:var(--ink); padding:8px 10px; border-radius:10px; font-weight:600; cursor:pointer; box-shadow:0 6px 16px rgba(12,23,52,.06) }
    .btn.primary{ background:#eef4ff; border-color:#dbe6ff; color:var(--brand) }
    .btn.ghost{ background:rgba(255,255,255,.85) }

    h1{ font-size: clamp(16px,2.2vw,22px); margin:0 }
    .sub{ color:var(--ink-2); margin-top:6px }
    .badges{ display:flex; gap:8px; flex-wrap:wrap; margin-top:12px }
    .badge{ background:#eef4ff; border:1px solid #dbe6ff; color:#2140b8; padding:6px 10px; border-radius:999px; font-weight:800; font-size:12px }

    .contacts{ margin-top:12px; background:#fff; border:1px solid var(--line); border-radius:14px; padding:10px; box-shadow:0 8px 22px rgba(12,23,52,.06) }
    .contacts h4{ margin:0 0 8px 0; font-size:14px; color:#253157 }
    .link-list{ display:flex; flex-wrap:wrap; gap:8px }
    .link-pill{ display:inline-flex; align-items:center; gap:6px; border:1px solid #e2e8f6; background:#f6f9ff; color:#1f3aa2; padding:6px 9px; border-radius:999px; font-size:12px }
    .link-pill button{ border:none; background:transparent; cursor:pointer; color:#6c7bb0; font-size:14px; line-height:1 }
    .add-link{ display:flex; gap:6px; margin-top:8px }
    .add-link input, .add-link select{ flex:1; border:1px solid var(--line); border-radius:10px; padding:8px 10px; font-size:13px }
    .add-link input.hidden{ display:none }
    .link-pill svg{ width:14px; height:14px }

    /* Modal actions (generic) */
    .modal-actions{ display:flex; gap:10px; justify-content:flex-end; align-items:center; margin-top:12px; }
    .modal-actions button{
      width:auto !important; display:inline-flex !important; align-items:center; justify-content:center;
      appearance:none; cursor:pointer; padding:10px 16px; border-radius:14px; font-weight:800; line-height:1.1;
      border:1.5px solid #dbe6ff; background:#fff; color:#1f3aa2;
    }
    .modal-actions .btn-primary{ background:#1f4aff; color:#fff; border-color:#1f4aff; }
    .modal-actions .btn-ghost{ background:transparent; color:#0b152c; border-color:transparent; }
    .modal-actions button:focus-visible{ outline:2px solid #1f4aff; outline-offset:2px; }
    @media (max-width:480px){ .modal-actions{ flex-wrap:wrap; justify-content:flex-end; } }

    /* Bio card */
    .body{ margin-top:18px; background:#fff; border:1px solid var(--line); border-radius:16px; box-shadow:0 10px 30px rgba(12,23,52,.06); padding:18px }
    .toolbar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:12px }
    .toggle{ display:flex; align-items:center; gap:6px; font-size:13px; color:#2e3a62 }
    .dropzone{ border:2px dashed #d8e1f7; border-radius:12px; padding:14px; text-align:center; color:#5a6aa0; cursor:pointer }
    .dropzone.hover{ border-color:#9fb2ff; background:#f3f6ff }
    .hidden{ display:none }

    /* Polished content styles */
    #bioView{ line-height:1.65; font-size:15px }
    #bioView p{ margin:0 0 .75rem }
    #bioView h1,#bioView h2,#bioView h3{ font-weight:800; line-height:1.2; margin:1.2rem 0 .5rem }
    #bioView h1{ font-size:1.4rem }
    #bioView h2{ font-size:1.25rem }
    #bioView h3{ font-size:1.15rem }
    #bioView ul,#bioView ol{ padding-left:1.2rem; margin:.5rem 0 .75rem }
    #bioView blockquote{ border-left:3px solid #dbe6ff; margin:1rem 0; padding:.5rem 0 .5rem .9rem; color:#4c5c83; background:#f7faff; border-radius:8px }
    #bioView code{ font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; font-size:.9em; background:#f5f7ff; padding:.15em .35em; border-radius:6px }
    #bioView pre{ background:#0b152c; color:#e6edff; padding:.9rem; border-radius:12px; overflow:auto }
    #bioView a{ color:#2140b8; text-decoration:underline; text-underline-offset:3px }

    /* Images */
    #bioView img{ display:block; max-width:100%; height:auto; border-radius:12px; border:1px solid var(--line); box-shadow:0 6px 18px rgba(12,23,52,.08); margin:.75rem 0 }
    #bioView figure{ margin:1rem 0 }
    #bioView figure img{ margin:.25rem auto }
    #bioView figcaption{ font-size:12px; color:#4c5c83; text-align:center; margin-top:6px }

    /* Tables */
    #bioView table{ width:100%; border-collapse:collapse; margin:.85rem 0 }
    #bioView th, #bioView td{ border:1px solid var(--line); padding:8px 10px; text-align:left; vertical-align:top }
    #bioView thead th{ background:#f3f6ff; font-weight:800 }
    #bioView tbody tr:nth-child(even){ background:#fafcff }
    @media (max-width: 640px){ #bioView table{ display:block; overflow-x:auto; white-space:nowrap } }

    #bioEditor{ width:100%; min-height:220px; border:1px solid var(--line); border-radius:12px; padding:12px; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:14px }

   /* === Inquiry dialog — restore previous layout (navy band + split footer) === */

/* Shell */
#inqDialog{
  padding:0; border:none; border-radius:18px;
  width:min(860px, calc(100vw - 32px));
  box-shadow:0 30px 80px rgba(12,23,52,.35);
}
#inqDialog::backdrop{
  background:rgba(11,21,44,.65);
  backdrop-filter:blur(2px);
}

/* Header */
#inqDialog .dialog-head{
  padding:14px 18px;
  font-weight:800;
  background:linear-gradient(180deg,#f7faff,#eef4ff);
  border-bottom:1px solid #e7edf7;
  border-radius:18px 18px 0 0;
}

/* Body: navy band with white fields */
#inqDialog .dialog-body{
  padding:16px 18px;
  background:#0b152c;            /* navy band */
  color:#e6edff;
}
#inqDialog .dialog-body form{ display:grid; gap:12px; }
#inqDialog .dialog-body input,
#inqDialog .dialog-body textarea,
#inqDialog .dialog-body select{
  display:block; width:100%; box-sizing:border-box;
  padding:12px; border-radius:12px;
  border:1.5px solid #dbe6ff;     /* soft/light border */
  background:#fff; color:#0b152c;
}
#inqDialog .dialog-body ::placeholder{ color:#6b7897; }
#inqDialog small{ display:block; margin-top:2px; color:#c7d2fe; }

/* Footer: split buttons left/right */
#inqFoot{ justify-content:space-between !important; } /* Close ← → Send */
#inqDialog .modal-actions{
  display:flex !important;
  justify-content:space-between !important;
  align-items:center !important;
  gap:12px !important;
  padding:12px 16px !important;
  background:#f7faff !important;
  border-top:1px solid #e7edf7 !important;
  border-radius:0 0 18px 18px;
}
#inqDialog .ft-btn{
  display:inline-flex !important;
  width:auto !important;
  align-items:center; justify-content:center;
  border:1.5px solid #dbe6ff; border-radius:14px;
  padding:12px 18px; font-weight:800; line-height:1.1;
  background:#fff; color:#1f3aa2;
}
#inqDialog .btn-primary{ background:#1f4aff; color:#fff; border-color:#1f4aff }
#inqDialog .btn-ghost{ background:transparent; border-color:transparent; color:#0b152c }


    /* Footer */
    footer{ border-top:1px solid var(--line); padding:18px 0; color:#6b7897 }
    footer a{ color:#2140b8; text-decoration:none; font-weight:700 }
    footer a:hover{ text-decoration:underline }
    .legal{ display:flex; justify-content:center; align-items:center; gap:10px; flex-wrap:wrap; text-align:center }
    .mini{ font-size:12px }

    @media (max-width:780px){
      .head{ grid-template-columns:1fr }
      .photo-wrap{ order:-1 }
    }
    </style>
    <style id="nav-fallback">
/* Fallback: hamburger visibile solo <980px; menu a pannello */
.nav-toggle{display:none;}
@media (max-width:980px){
  .nav-toggle{
    display:inline-flex; appearance:none; border:1px solid #dbe6ff; background:#fff; color:#143166;
    width:40px; height:40px; border-radius:10px; align-items:center; justify-content:center; cursor:pointer;
  }
  header nav{ position:static; margin-left:0; flex:unset; }
  header nav ul{
    position:absolute; right:16px; top:72px; display:none; flex-direction:column; gap:10px;
    background:#fff; border:1px solid #e7edf7; border-radius:14px; padding:12px;
    box-shadow:0 10px 30px rgba(12,23,52,.10); z-index:50; min-width:220px;
  }
  body.nav-open header nav ul{ display:flex; }
  header nav a{ display:block; width:100%; text-align:left; min-height:44px; }
}
</style>
  
  
  <link rel="stylesheet" href="assets/site-responsive.css">

<script defer src="assets/ui-mode-toggle.js"></script>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand"><div class="mark" aria-hidden="true">TSN</div><h1 class="text-lg font-extrabold">The (un)Stable Net</h1></div>
      <button id="navToggle" class="nav-toggle" aria-controls="primaryNav" aria-expanded="false" data-view-allowed>
      <span class="sr-only">Toggle navigation</span>
      <svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
      <nav id="primaryNav" aria-label="Primary">
        <ul class="pill-row">
          <li><a class="pill-btn" href="home.html">Home</a></li>
          <li><button id="openInquiry" class="pill-btn primary" type="button" data-view-allowed>Ask a question</button></li>
        </ul>
      </nav>
  
    </div>
    </header> 

  <main class="wrap">
    <div class="head">
      <!-- LEFT: photo + contacts -->
      <div class="photo-wrap">
        <div id="photo" class="photo" title="Drop a photo here or use Upload"></div>
        <div class="photo-actions">
          <button class="btn primary" id="uploadBtn">Upload Photo</button>
          <button class="btn" id="clearPhoto" title="Remove saved photo">Clear</button>
        </div>
        <input type="file" id="photoFile" accept="image/*" class="hidden" />

        <div class="contacts">
          <h4>Contacts</h4>
          <div id="links" class="link-list" data-view-allowed></div>
          <div class="add-link only-editor">
            <select id="linkType">
              <option value="email">Email</option>
              <option value="linkedin">LinkedIn</option>
              <option value="youtube">YouTube</option>
              <option value="github">GitHub</option>
              <option value="x">X</option>
              <option value="other">Other</option>
            </select>
            <input id="linkLabel" placeholder="Custom label (for Other)" class="hidden" />
            <input id="linkURL" placeholder="URL or email" />
            <button class="btn" id="addLinkBtn">Add</button>
          </div>
        </div>
      </div>

      <!-- RIGHT: heading + bio -->
      <div>
        <h1>About The (un)Stable Net's founder</h1>
        <p class="sub"><i>I turn market noise into crisp briefs and ship small, useful AI products for SMEs and teams.</i></p>
        <div class="badges">
          <span class="badge">Markets & Strategy</span>
          <span class="badge">AI Tooling</span>
          <span class="badge">Event Planning</span>
        </div>

        <section class="body" id="bioCard">
          <div class="toolbar">
            <label class="toggle"><input type="checkbox" id="renderAsHTML"> Render as HTML (sanitized)</label>
            <button class="btn" id="editBio">Edit</button>
            <label class="btn" for="bioFile" style="cursor:pointer">Import .txt / .html</label>
            <input type="file" id="bioFile" accept=".txt,.html,.htm,.md" class="hidden" />
            <button class="btn" id="saveBio">Save</button>
            <button class="btn" id="resetBio">Clear</button>
            <button class="btn" id="polishBio">Polish</button>
          </div>

          <div id="dropzone" class="dropzone hidden">
            Drop a .txt/.html file here, or click “Import” above — or paste content via “Edit”.
          </div>

          <div id="bioView"></div>
          <textarea id="bioEditor" class="hidden" placeholder="Paste text or HTML here…"></textarea>
        </section>
      </div>
    </div>
  </main>

  <footer>
    <div class="wrap legal mini">
      <span>© <span id="y"></span> The (un)Stable Net</span>
      <span aria-hidden="true">•</span>
      <a href="assets/legal/privacy-policy.pdf" target="_blank" rel="noopener">Privacy Policy (PDF)</a>
      <span aria-hidden="true">•</span>
      <a href="assets/legal/terms.pdf" target="_blank" rel="noopener">Terms &amp; Conditions (PDF)</a>
    </div>
  </footer>

  <!-- Inquiry Dialog -->
  <dialog id="inqDialog" data-to-email="jacopoberton98@gmail.com" data-view-allowed>
    <div class="dialog-head">Question / Collaboration Inquiry</div>
    <div class="dialog-body">
      <form id="inqForm" data-view-allowed>
        <input name="name" placeholder="Your name" required data-view-allowed />
        <input name="email" type="email" placeholder="Your email" required data-view-allowed />
        <input name="topic" placeholder="Topic (optional)" data-view-allowed />
        <textarea name="message" rows="6" placeholder="Your message" required data-view-allowed></textarea>
        <small>On submit, your mail app opens with a pre-filled email to the contact address.</small>
      </form>
    </div>

    <!-- Footer (buttons split left/right) -->
    <div class="modal-actions" id="inqFoot">
      <button class="ft-btn btn-ghost" id="closeInq" type="button" data-view-allowed>Close</button>
      <button class="ft-btn btn-primary" id="sendInq" type="button" data-view-allowed>Send</button>
    </div>
  </dialog>

  <script>
  (function(){
    const $ = (s, r=document) => r.querySelector(s);
    const LS = { photo:'tsn_bio_photo', content:'tsn_bio_content', mode:'tsn_bio_mode', links:'tsn_contacts' };

    // Year
    $('#y').textContent = new Date().getFullYear();

    // Photo upload
    const photoEl = $('#photo'), photoFile = $('#photoFile');
    const uploadBtn = $('#uploadBtn'), clearPhotoBtn = $('#clearPhoto');
    const loadPhoto = () => { const u = localStorage.getItem(LS.photo); if (u) photoEl.style.backgroundImage = `url('${u}')`; };
    const savePhoto = f => { const r = new FileReader(); r.onload = e => { localStorage.setItem(LS.photo, e.target.result); loadPhoto(); }; r.readAsDataURL(f); };
    uploadBtn.addEventListener('click', ()=> photoFile.click());
    photoFile.addEventListener('change', e => { const f = e.target.files?.[0]; if (f) savePhoto(f); photoFile.value=''; });
    clearPhotoBtn.addEventListener('click', ()=>{ localStorage.removeItem(LS.photo); photoEl.style.backgroundImage = "url('https://dummyimage.com/800x800/1b274d/ced9ff&text=Your+Photo')"; });
    ['dragenter','dragover'].forEach(evt => photoEl.addEventListener(evt, e => { e.preventDefault(); photoEl.classList.add('drop'); }));
    ['dragleave','drop'].forEach(evt => photoEl.addEventListener(evt, e => { e.preventDefault(); photoEl.classList.remove('drop'); }));
    photoEl.addEventListener('drop', e => { const f=e.dataTransfer.files?.[0]; if (f?.type.startsWith('image/')) savePhoto(f); });
    loadPhoto();

    // Contacts
    const linksWrap = $('#links'), linkType = $('#linkType'), linkLabel = $('#linkLabel'), linkURL = $('#linkURL'), addLinkBtn = $('#addLinkBtn');
    const ICONS = {
      email:'<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M2 6.5A2.5 2.5 0 0 1 4.5 4h15A2.5 2.5 0 0 1 22 6.5v11A2.5 2.5 0 0 1 19.5 20h-15A2.5 2.5 0 0 1 2 17.5v-11Zm2.2-.5 7.3 5.1L18.8 6H4.2Zm15.3 2.1-7.8 5.4a1 1 0 0 1-1.2 0L2.7 8.1V17.5c0 .55.45 1 1 1h15.8c.55 0 1-.45 1-1V8.1Z"/></svg>',
      linkedin:'<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M4.98 3.5A2.5 2.5 0 1 1 0 3.5 2.5 2.5 0 0 1 4.98 3.5ZM.5 8.5h4V23h-4V8.5Zm7.5 0h3.8v2h.1c.5-.9 1.7-2.2 3.6-2.2 3.9 0 4.6 2.6 4.6 6V23h-4v-6.5c0-1.6 0-3.7-2.3-3.7s-2.7 1.7-2.7 3.6V23h-4V8.5Z"/></svg>',
      youtube:'<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M23 12c0 2.2-.2 3.7-.5 4.6-.3.8-1 1.5-1.8 1.8C18.8 19 12 19 12 19s-6.8 0-8.7-.6c-.8-.3-1.5-1-1.8-1.8C.2 15.7 0 14.2 0 12s.2-3.7.5-4.6c.3-.8 1-1.5 1.8-1.8C5.2 5 12 5 12 5s6.8 0 8.7.6c.8.3 1.5 1 1.8 1.8.3.9.5 2.4.5 4.6ZM9.75 8.5v7l6-3.5-6-3.5Z"/></svg>',
      github:'<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 .5a12 12 0 0 0-3.8 23.4c.6.1.8-.2.8-.6v-2.2c-3.3.7-4-1.6-4-1.6-.5-1.2-1.1-1.5-1.1-1.5-.9-.6.1-.6.1-.6 1 .1 1.5 1 1.5 1 .9 1.5 2.4 1.1 3 .9.1-.7.4-1.1.7-1.4-2.6-.3-5.3-1.3-5.3-5.9 0-1.3.5-2.4 1.2-3.3-.1-.3-.5-1.6.1-3.4 0 0 1-.3 3.4 1.2a11.7 11.7 0 0 1 6.2 0c2.4-1.5 3.4-1.2 3.4-1.2.6 1.8.2 3.1.1 3.4.8.9 1.2 2 1.2 3.3 0 4.6-2.7 5.6-5.4 5.9.4.3.8 1 .8 2v3c0 .4.2.7.8.6A12 12 0 0 0 12 .5Z"/></svg>',
      x:'<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M18.9 2 13.6 9.2 21.8 22h-6.5l-4.4-6.7L5.8 22H2l7.1-9.8L2.2 2h6.5l4 6.1L17 2h1.9Z"/></svg>'
    };
    const LABELS = { email:'Email', linkedin:'LinkedIn', youtube:'YouTube', github:'GitHub', x:'X', other:'Other' };
    const PLACEHOLDERS = {
      email:'you@domain.com', linkedin:'https://www.linkedin.com/in/your-handle',
      youtube:'https://youtube.com/@yourchannel', github:'https://github.com/your-handle',
      x:'https://x.com/your-handle', other:'https://… or mailto:…'
    };
    const getLinks = () => { try { return JSON.parse(localStorage.getItem(LS.links) || '[]'); } catch { return []; } };
    const setLinks = (a) => localStorage.setItem(LS.links, JSON.stringify(a));
    const normalizeURL = (t,u)=>{ if(!u) return ''; u=u.trim(); if(t==='email'){ if(!/^mailto:/i.test(u)&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u)) return 'mailto:'+u; return u; } if(!/^https?:/i.test(u)&&!/^mailto:/i.test(u)) u='https://'+u; return u; };
    const guessType = (it)=>{ if(it.type) return it.type; const u=(it.url||'').toLowerCase(); if(/^mailto:/.test(u)||(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u)&&!u.startsWith('http'))) return 'email'; if(u.includes('linkedin.com')) return 'linkedin'; if(u.includes('github.com')) return 'github'; if(u.includes('youtube.com')||u.includes('youtu.be')) return 'youtube'; if(u.includes('x.com')||u.includes('twitter.com')) return 'x'; return 'other'; };
    linkType.addEventListener('change', ()=>{ const t=linkType.value; linkURL.placeholder = PLACEHOLDERS[t] || 'URL or email'; linkLabel.classList.toggle('hidden', t!=='other'); });
    linkType.dispatchEvent(new Event('change'));
    function renderLinks(){
      linksWrap.innerHTML=''; const arr=getLinks();
      arr.forEach((it,idx)=>{ const type=guessType(it), label=it.label||LABELS[type]||'Link';
        const pill=document.createElement('span'); pill.className='link-pill';
        const icon=document.createElement('span'); icon.innerHTML=ICONS[type]||''; pill.appendChild(icon);
        const a=document.createElement('a'); a.href=it.url; a.target=(/^https?:/i.test(it.url))?'_blank':'_self'; a.rel='noopener'; a.textContent=label; pill.appendChild(a);
        const x=document.createElement('button'); x.type='button'; x.textContent='✕'; x.title='Remove';
        x.addEventListener('click', ()=>{ const a2=getLinks(); a2.splice(idx,1); setLinks(a2); renderLinks(); ensureEmailHint(); });
        pill.appendChild(x); linksWrap.appendChild(pill);
      });
      ensureEmailHint();
    }
    addLinkBtn.addEventListener('click', ()=>{ const type=linkType.value; const url=normalizeURL(type, linkURL.value.trim()); const label=(type==='other')?(linkLabel.value||'').trim():LABELS[type]; if(!url) return; if(type==='other'&&!label) return; const arr=getLinks(); arr.push({type,label,url}); setLinks(arr); linkURL.value=''; linkLabel.value=''; renderLinks(); });

    // BIO
    const bioView = $('#bioView'), bioEditor = $('#bioEditor'), renderAsHTML = $('#renderAsHTML');
    const editBioBtn = $('#editBio'), saveBioBtn = $('#saveBio'), resetBioBtn = $('#resetBio'), bioFile = $('#bioFile'), dropzone = $('#dropzone');

    // Decode & normalize
    const decodeEntities = (s)=>{ const t = document.createElement('textarea'); t.innerHTML = s; return t.value; };
    const normalizeWhitespace = (s)=> s.replace(/\r\n?/g,'\n').replace(/[ \t]+\n/g,'\n').replace(/\n{3,}/g,'\n\n').trim();

    // Make markup tidy & consistent
    const polishHTML = (raw)=>{
      if (/&lt;|&gt;|&amp;/.test(raw) && !/<[a-z!/]/i.test(raw)) raw = decodeEntities(raw);
      raw = normalizeWhitespace(raw)
        .replace(/(\s*<br\s*\/?>(\s|\u00A0)*){2,}/gi, '</p><p>')
        .replace(/<\s*b(\s*[^>]*)?>/gi,'<strong>').replace(/<\s*\/\s*b\s*>/gi,'</strong>')
        .replace(/<\s*i(\s*[^>]*)?>/gi,'<em>').replace(/<\s*\/\s*i\s*>/gi,'</em>');
      if (!/<\s*(p|h1|h2|h3|ul|ol|blockquote|pre|div|table|figure|img)\b/i.test(raw)) {
        raw = raw.split(/\n{2,}/).map(s => `<p>${s.trim()}</p>`).join('');
      }
      raw = raw.replace(/<\s*h([4-6])\b[^>]*>/gi, '<h3>').replace(/<\/\s*h([4-6])\s*>/gi, '</h3>');
      return raw.trim();
    };

    // Rebuild-only sanitizer (IMG + TABLE support)
    const sanitizeHTML = (html)=>{
      const allowed = new Set(['A','P','DIV','H1','H2','H3','EM','STRONG','UL','OL','LI','BR','HR','BLOCKQUOTE','CODE','PRE','SPAN','IMG','FIGURE','FIGCAPTION','TABLE','THEAD','TBODY','TFOOT','TR','TH','TD']);
      const doc = new DOMParser().parseFromString(html,'text/html');
      const out = doc.createElement('div');

      const allowURL = (url)=>{
        if (!url) return false;
        const v = url.trim();
        if (/^https:\/\//i.test(v)) return true;
        if (/^data:image\//i.test(v)) return true;
        if (/^blob:/i.test(v)) return true;
        return false;
      };

      const scrub = (src, dst)=>{
        src.childNodes.forEach(node=>{
          if (node.nodeType === Node.TEXT_NODE) { dst.appendChild(doc.createTextNode(node.nodeValue)); return; }
          if (node.nodeType === Node.ELEMENT_NODE) {
            const tag = node.tagName;
            if (!allowed.has(tag)) {
              if (tag === 'SCRIPT' || tag === 'STYLE' || tag === 'IFRAME' || tag === 'OBJECT' || tag === 'EMBED') return;
              scrub(node, dst);
              return;
            }
            const el = doc.createElement(tag);
            if (tag === 'A') {
              const href = (node.getAttribute('href')||'').trim();
              if (/^(https?:|mailto:|#)/i.test(href)) { el.setAttribute('href', href); el.setAttribute('rel','noopener noreferrer nofollow'); el.setAttribute('target','_blank'); }
            } else if (tag === 'IMG') {
              const srcAttr = (node.getAttribute('src')||'').trim();
              const altAttr = (node.getAttribute('alt')||'').slice(0,200);
              if (allowURL(srcAttr)) { el.setAttribute('src', srcAttr); if (altAttr) el.setAttribute('alt', altAttr); el.setAttribute('loading','lazy'); el.setAttribute('decoding','async'); }
            }
            dst.appendChild(el);
            scrub(node, el);
          }
        });
      };

      scrub(doc.body, out);
      return out.innerHTML;
    };

    const applyBio = ()=>{
      const mode=(localStorage.getItem(LS.mode)||'text');
      const raw=localStorage.getItem(LS.content)||'';
      renderAsHTML.checked=(mode==='html');
      if(!raw){ $('#bioView').classList.add('hidden'); $('#dropzone').classList.remove('hidden'); }
      else{
        $('#dropzone').classList.add('hidden'); $('#bioView').classList.remove('hidden');
        $('#bioView')[mode==='html'?'innerHTML':'textContent'] = (mode==='html'? sanitizeHTML(raw) : raw);
      }
    };

    editBioBtn.addEventListener('click', ()=>{
      bioEditor.classList.toggle('hidden');
      if(!bioEditor.classList.contains('hidden')){ bioEditor.value=localStorage.getItem(LS.content)||''; bioEditor.focus(); }
    });

    // Save (polish + sanitize in HTML mode)
    saveBioBtn.addEventListener('click', ()=>{
      let raw = bioEditor.classList.contains('hidden') ? (localStorage.getItem(LS.content)||'') : bioEditor.value;
      if (renderAsHTML.checked) raw = sanitizeHTML(polishHTML(raw));
      localStorage.setItem(LS.content, raw);
      localStorage.setItem(LS.mode, renderAsHTML.checked ? 'html' : 'text');
      applyBio();
      if (!bioEditor.classList.contains('hidden')) bioEditor.classList.add('hidden');
    });

    // Clear
    resetBioBtn.addEventListener('click', ()=>{
      localStorage.removeItem(LS.content);
      localStorage.setItem(LS.mode, renderAsHTML.checked?'html':'text');
      bioEditor.value=''; applyBio();
    });

    // Import
    bioFile.addEventListener('change', e=>{
      const f=e.target.files?.[0]; if(!f) return;
      const r=new FileReader();
      r.onload=ev=>{
        const text=ev.target.result;
        bioEditor.value=text;
        const isHTML=/\.html?$/i.test(f.name)||/^\s*<(!doctype|html|head|body|p|h1|div|figure|img|table)/i.test(text);
        renderAsHTML.checked=!!isHTML;
        bioEditor.classList.remove('hidden');
      };
      r.readAsText(f); bioFile.value='';
    });

    // Dropzone
    ['dragenter','dragover'].forEach(evt => dropzone.addEventListener(evt, e=>{ e.preventDefault(); dropzone.classList.add('hover'); }));
    ['dragleave','drop'].forEach(evt => dropzone.addEventListener(evt, e=>{ e.preventDefault(); dropzone.classList.remove('hover'); }));
    dropzone.addEventListener('drop', e=>{
      const f=e.dataTransfer.files?.[0]; if(!f) return;
      const r=new FileReader();
      r.onload=ev=>{
        const text=ev.target.result;
        bioEditor.value=text;
        renderAsHTML.checked= /\.html?$/i.test(f.name) || /^\s*</.test(text);
        bioEditor.classList.remove('hidden'); dropzone.classList.add('hidden');
      };
      r.readAsText(f);
    });

    // Polish button
    $('#polishBio').addEventListener('click', ()=>{
      const raw = bioEditor.classList.contains('hidden') ? (localStorage.getItem(LS.content)||'') : bioEditor.value;
      const polished = sanitizeHTML(polishHTML(raw));
      renderAsHTML.checked = true;
      bioEditor.classList.remove('hidden'); bioEditor.value = polished;
      localStorage.setItem(LS.content, polished); localStorage.setItem(LS.mode, 'html'); applyBio();
    });

    // Auto-polish when toggling HTML view
    renderAsHTML.addEventListener('change', ()=>{
      let raw = bioEditor.classList.contains('hidden') ? (localStorage.getItem(LS.content)||'') : bioEditor.value;
      if (renderAsHTML.checked) { raw = sanitizeHTML(polishHTML(raw)); if (!bioEditor.classList.contains('hidden')) bioEditor.value = raw; localStorage.setItem(LS.mode, 'html'); }
      else { localStorage.setItem(LS.mode, 'text'); }
      localStorage.setItem(LS.content, raw); applyBio();
    });

    // Inquiry
    const inqDialog = $('#inqDialog'); const openInquiry = $('#openInquiry');
    function ensureEmailHint(){ const mail=(getLinks().find(l=>/^mailto:/i.test(l.url))||{}).url||''; inqDialog.dataset.toEmail = mail.replace(/^mailto:/i,''); }
    openInquiry.addEventListener('click', ()=> inqDialog.showModal());
    $('#closeInq').addEventListener('click', ()=> inqDialog.close());
    $('#sendInq').addEventListener('click', ()=>{
      const fd = new FormData($('#inqForm'));
      const name = (fd.get('name')||'').toString();
      const from = (fd.get('email')||'').toString();
      const topic= (fd.get('topic')||'').toString();
      const msg  = (fd.get('message')||'').toString();
      const to = inqDialog.dataset.toEmail || 'jacopoberton98@gmail.com';
      const subject = `Inquiry${topic ? ': ' + topic : ''} — from ${name}`;
      const body = `Name: ${name}\nEmail: ${from}\nTopic: ${topic}\n\n${msg}\n\n— sent from Bio page`;
      window.location.href = `mailto:${encodeURIComponent(to)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      inqDialog.close();
    });

    // Seed & init
    if (!localStorage.getItem(LS.links)) {
      setLinks([{label:'Email', url:'mailto:hello@example.com'},{label:'LinkedIn', url:'https://www.linkedin.com/in/your-handle'},{label:'X (Twitter)', url:'https://x.com/your-handle'}]);
    }
    renderLinks(); applyBio(); ensureEmailHint();
  })();
  </script>
<script>
(function(){
  const btn = document.getElementById('navToggle');
  const nav = document.getElementById('primaryNav');
  if(!btn || !nav) return;

  // Toggle apertura/chiusura
  btn.addEventListener('click', ()=>{
    const open = document.body.classList.toggle('nav-open');
    btn.setAttribute('aria-expanded', open ? 'true' : 'false');
  });

  // Assicura che l'hamburger NON si veda su desktop
  const mq = matchMedia('(max-width:980px)');
  const update = ()=>{ btn.style.display = mq.matches ? 'inline-flex' : 'none'; };
  update(); mq.addEventListener('change', update);

  // Compatibilità con il tuo "viewer"
  try { btn.setAttribute('data-view-allowed',''); nav.querySelectorAll('a').forEach(a=>a.setAttribute('data-view-allowed','')); } catch(_){}
})();
</script>

  <!-- Your modules -->
  <script type="module" src="assets/sb-init.js"></script>
  <script type="module" src="assets/dynamic-bio.js"></script>
  <script type="module" src="assets/dynamic-bio-content.js"></script>
  <script type="module" src="assets/editor-auth.js"></script>
  <script type="module" src="assets/editor-tray.js"></script>
  <script type="module" src="assets/editor-quiet.js"></script>
  <script type="module" src="assets/editor-unlock.js"></script>
<script type="module" src="assets/live-all-norepl.js"></script>
</body></html>
